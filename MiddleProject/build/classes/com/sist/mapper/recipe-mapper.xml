<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.mapper.Recipe-mapper">
	<insert id="RecipeDataInsert" parameterType="RecipeVO">
		insert into recipe(no,poster,summary_in,info,step,STEP_POSTER,summary,complete,tag,tip,hit,ingre,made) values(
			(select NVL(max(no)+1,1) from recipe),
			#{poster},
			#{summary_in},
			#{info},
			#{step},
			#{STEP_POSTER},
			#{summary},
			#{complete},
			#{tag},
			#{tip},
			#{hit},
			#{ingre},
			#{made}
		)
	</insert>
	<!-- list data -->
	<select id="recipeListData" parameterType="java.util.Map" resultType="RecipeVO" >
		select no,hit,made,tag,TO_CHAR(regdate,'YYYY-MM-DD')as regdate,poster,info,summary,summary_in,num 
		from (select no,hit,made,tag,regdate,poster,info,summary,summary_in,rownum as num
		from (select no,hit,made,tag,regdate,poster,info,summary,summary_in
		from recipe order by no desc))
		where num between #{start} and #{end}
	</select>
	<!-- 레시피 전체 데이터 -->
	<select id="RecipeAllData" resultType="RecipeVO">
		select * from recipe
	</select>
	<!-- 레시피 카운터 -->
	<select id="RecipeCount" resultType="int">
		select count(*) from recipe
	</select>
	<select id="RecipeTotalPage" resultType="int">
      SELECT CEIL(COUNT(*)/6.0) FROM recipe
   </select>
	
	<!-- DetailData -->
	<select id="detailData" parameterType="int" resultType="RecipeVO">
		select * from recipe where no=#{no}
	</select>	
	<!-- hot Recipe 
		private int no;
		private String poster;
		private String summary_in;
		private String info;
		private String step;
		private String STEP_POSTER;
		private String summary;
		private String complete;
		private String regdate;
		private String tag;
		private String tip;
		private int hit;
		private String ingre;
		private String made;
		private String image;
	-->
	<select id="HotRecipe" parameterType="int" resultType="RecipeVO">
		select no,poster,summary_in,info,step,STEP_POSTER,summary,complete,regdate,tag,tip,hit,ingre,made,image,num
		from (select no,poster,summary_in,info,step,STEP_POSTER,summary,complete,regdate,tag,tip,hit,ingre,made,image,rownum as num
		from recipe order by hit desc)
		where num &lt;=#{num}
	</select>
	<!-- 태그 검색 
	<foreach collection="name_List" item="item" separator="," open="(" close=")">
			#{item}
		</foreach>
	-->
	<select id="tagselect" parameterType="java.util.Map" resultType="RecipeVO">
		select no,poster,summary,summary_in,hit,num from (select no,poster,summary,summary_in,hit,rownum as num 
		from recipe <where>
			<foreach collection="tagStr" item="tag" separator="or">
				tag LIKE '%'||#{tag}||'%'
			</foreach>
		</where>)
		where num &lt;=4
	</select>
</mapper>